<% if suspended? -%>
IMPORTANT: Account '<%= @abuse.username %>' is suspended due to Resource Abuse - <%= @abuse.server.name %>
<% else -%>
WARNING: Resource Abuse on Account '<%= @abuse.username %>' - <%= @abuse.server.name %>
<% end -%>

Hello,

It has come to our attention that the '<%= @abuse.username %>' hosting account is overusing limits of shared resources, affecting the server performance and other accounts hosted therein. We would like to mention that all the limits set for shared hosting accounts are burstable in order to let every account handle load pikes, however those pikes must not be persistent not to cause impact on all accounts of the shared server. In order to obtain additional information about the limits please refer to Paragraph 10. "Additional Acceptable Use Policy for Virtual accounts" of our AUP at http://www.namecheap.com/legal/hosting/aup.aspx

<% if @abuse.resource.abuse_type_ids == [5] -%>
The server is abused by MySQL queries.
<% elsif !@abuse.resource.abuse_type_ids.include?(5) -%>
The following resource limits are being exceeded:

<%= @abuse.resource.abuse_types.map(&:name).map { |r| "- #{r}" }.join("\n") %>
<% else -%>
The server is abused by MySQL queries and the following resource limits are being exceeded:

<%= (@abuse.resource.abuse_types.map(&:name) - ['MySQL Queries']).map { |r| "- #{r}" }.join("\n") %>
<% end -%>

Unoptimized scripts / incorrectly configured cron jobs / a lot of simultaneous visitors / etc. are probable causes of the resource overuse. Here are the diagnostic steps generally suggested for finding the corresponding solution:

<% if (@abuse.resource.abuse_type_ids & [1, 2, 3, 5]).present? -%>
- enable caching plugins (Note: Such plugins in conjunction with other website elements might malfunction. That is why in case one of the plugins is already in use it is required to disable the plugin temporary and monitor the account’s activity.)
<% end -%>
<% if @abuse.resource.abuse_type_ids.include?(5) -%>
- revise all active plugins disabling unnecessary ones (in some cases even changing the current theme might be of use)
- make sure that all websites are well optimized and working as expected (if you are not a developer or professional in website administration, we strongly recommend reaching out to webmaster services)
- if the SSH access is enabled for the account it is possible to check which threads are being processed by the MySQL server:
  Step 1 - Connect to your database using the following command:  mysql -uusername -ppassword database_name
  Step 2 - Once connected, please use the following command to see the active threads:  show full processlist
<% end -%>
<% if @abuse.resource.abuse_type_ids.include?(3) -%>
- make sure that RSS is not enabled on your website
- please refer to the Awstats option in cPanel (in case at least one of your websites is receiving a considerably high amount of hits/incoming traffic volume, an upgrade is the most valid solution)
- if the SSH access is enabled for the account the “ top -c ” command is of use in order to find the webpages causing the most significant impact (in case an active process takes much time or a critical amount of virtual memory for being completed, it should be disabled)
<% end -%>
<% if @abuse.resource.abuse_type_ids.include?(4) -%>
- please consider applying DDoS protection services. Currently Namecheap does not provide this type of services, therefore it is advised to find a third-party vendor
- it is advised to double-check all active scripts as some of them might be unoptimized
<% end -%>

The following Namecheap KnowledgeBase category contains articles about resource limits, LVE (Lightweight Virtual Environment) statistics and measures applicable for resource overuse issues https://www.namecheap.com/support/knowledgebase/subcategory.aspx/103/lve-cloudlinux

Additionally, you might consider upgrading your current hosting plan to <%= @abuse.resource.upgrade.name %>. All upgrades are processed on the prorate basis, thus it will be needed to pay only for the difference between the two plans. The prorated refund for your *current plan* will be carried over to your Namecheap funds, that can be used to settle the next generated invoice or pay for any other services with Namecheap.<% if @abuse.service_id == 2 %> If you are using third-party licenses (e.g. cPanel, Softaculous or WHMCS) purchased separately, pleases let us draw your attention that they are non-refundable according to the Acceptable Use Policy.<% end %>

<% if suspended? -%>
Unfortunately, we have been forced to suspend the reported account in order to prevent the resource abuse and its impact on other accounts located on the server. In order to have the account unsuspended it is required to confirm that all measures necessary for the issue resolving will be taken immediately after the unsuspension.
<% else -%>
It is required to look into the issue decreasing the resource usage and providing us with the corresponding results within the next <%= @abuse.suggestion.name.match(/\d+/).to_s %> hours. Otherwise, if the resource overuse persists after the time-frame provided and/or no response is received from your side we might be forced to suspend the account in question. We would like to emphasize that in case the impact on the server increases within the specified time-frame there might no other option but to suspend the account immediately, to our regret.
<% end -%>

Looking forward to your reply.

===============[ Please find the additional information below / attached ]===============
<% if (@abuse.resource.abuse_type_ids & [1, 2, 3, 4]).present? -%>

=====================================[ LVE Report ]======================================

<%= @abuse.resource.lve_report.strip %>
<% end -%>
<% if @abuse.resource.abuse_type_ids.include?(5) -%>

====================================[ MySQL Queries ]====================================

<%= @abuse.resource.mysql_queries.strip %>
<% end -%>
<% if @abuse.resource.abuse_type_ids.include?(5) && @abuse.resource.db_governor_logs.present? -%>

================================[ DataBase Load Report ]=================================

<%= @abuse.resource.db_governor_logs.strip %>
<% end -%>
<% if @abuse.resource.abuse_type_ids.include?(6) -%>

=====================================[ Process Log ]=====================================

<%= @abuse.resource.process_logs.strip %>
<% end -%>

======================================[ Notations ]======================================

ID — LVE ID or Username

aCPU — Average CPU Usage
mCPU — Max CPU Usage
lCPU — CPU Limit

aEP — Average Entry Processes
mEP — Max Entry Processes
lEP — Entry Processes Limit

aVMem — Average Virtual Memory Usage
mVMem — Max Virtual Memory Usage
lVMem — Virtual Memory Limit

VMemF — Out of Memory Faults
EPf — Entry Processes Faults

aPMem — Average Physical Memory Usage
mPMem — Max Physical Memory Usage
lPMem — Physical Memory Limit

aNproc — Average Number of Processes
mNproc — Max Number of Processes
lNproc — Number of Processes Limit

PMemF — Out of Physical Memory Faults
NprocF — Number of Processes Faults

aIO — Average Input/Output
mIO — Max Input/Output
lIO — Input/Output Limit

<% if @abuse.resource.abuse_type_ids.include?(5) && @abuse.resource.db_governor_logs.present? -%>
-----------------------------------------------------------------------------------------

TS : Timestamp
USER : Username
CPU : Average CPU Usage
READ : Average READ Usage
WRITE : Average WRITE Usage
CON : Average Outside Connections
lCPU : CPU Limit
lREAD : READ Limit
lWRITE : WRITE Limit
RESTRICT : C - CPU / R - READ / W - WRITE

<% end -%>
=========================================================================================