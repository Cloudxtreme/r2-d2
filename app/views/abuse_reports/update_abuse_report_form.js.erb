$("#abuse_report_form").html('<%= j(render partial: "abuse_reports/partials/#{@report_type}_fields", locals: { path: abuse_reports_path }) %>');

$(".date-picker").fdatepicker()
  .on('changeDate', function(ev){
    $(ev.target).change().focusout();
  });

$("form").validate();

$(".responded-previously-buttons").find("input[type='radio']").change(function(){
  toggleReferenceFields(this);
});
toggleReferenceFields($(".responded-previously-buttons").find("input[type='radio']:checked")[0]);

$(".free-dns-buttons").find("input[type='radio']").change(function(){
  toggleFreeDNSFields(this);
});
toggleFreeDNSFields($(".free-dns-buttons").find("input[type='radio']:checked")[0]);

$(".cfc-related-inputs").find("input[type='radio']").change(function(){
  validateCfcCommentField(this);
});
validateCfcCommentField($(".cfc-related-inputs").find("input[type='radio']:checked")[0]);

$('form').on('click', '.add-virtus-fields', function(event) {
  var regexp, time;
  time = new Date().getTime();
  regexp = new RegExp($(this).data('id'), 'g');
  $(this).closest('form').find('#virtus-fields-container').append($(this).data('fields').replace(regexp, time));
  $('#virtus-fields-container').find('textarea').enableClientSideValidations();
  event.preventDefault();
});

$('form').on('click', '.remove-virtus-fields', function(event) {
  $(this).closest('.virtus-fields').remove();
  event.preventDefault();
});

$("form").submit(function(event) {
  var checked = true;
  $(".relation-type-check-boxes").each(function(index, element) {
    if ($(element).find("input[type='checkbox']:checked")[0] === undefined) {
      checked = false;
    }
  });
  if (checked === false) {
    event.preventDefault();
    toastr.error("Please make sure at least one relation type is selected");
  }
});


function toggleReferenceFields(radio) {
  if ($(radio).val() == 0) {
    $(".reference-fields").find("input").val("foo").change().focusout().disableClientSideValidations().val("").attr("disabled", true);
  } else {
    $(".reference-fields").find("input").attr("disabled", false).enableClientSideValidations();
  }
};

function toggleFreeDNSFields(radio) {
  if ($(radio).val() == 'FreeDNS') {
    $('.free-dns-fields').find('input').attr('disabled', false).enableClientSideValidations();
  } else {
    $('.free-dns-fields').find('input').val('123').change().focusout().disableClientSideValidations().val('').attr('disabled', true);
  }
};

function validateCfcCommentField(radio) {
  $field = $(".cfc-comment textarea");
  if ($(radio).val() == 0) {
    if (/^\s*$/.test($field.val())) {
      $field.val("foo").change().focusout().disableClientSideValidations().val("");
    } else {
      $field.disableClientSideValidations();
    }
  } else {
    $field.enableClientSideValidations();
  }
};