$("#abuse_report_form").html("<%= j(render partial: 'abuse_reports/partials/form', locals: { abuse_report: @abuse_report }) %>");

$(".date-picker").fdatepicker()
  .on('changeDate', function(ev){
    $(ev.target).change().focusout();
  });

$("form").validate();

$(".responded-previously-buttons").find("input[type='radio']").change(function(){
  toggleReferenceFields(this);
});
toggleReferenceFields($(".responded-previously-buttons").find("input[type='radio']:checked")[0]);

$(".free-dns-buttons").find("input[type='radio']").change(function(){
  toggleFreeDNSFields(this);
});
toggleFreeDNSFields($(".free-dns-buttons").find("input[type='radio']:checked")[0]);

$(".cfc-related-inputs").find("input[type='radio']").change(function(){
  validateCfcCommentField(this);
});
validateCfcCommentField($(".cfc-related-inputs").find("input[type='radio']:checked")[0]);

$("#report-assignments").on('cocoon:after-insert', function(ev, el) {
  $(el).find('textarea').enableClientSideValidations();
});

$("form.new_abuse_report").submit(function(event) {
  var checked = true;
  $(".relation-type-check-boxes").each(function(index, element) {
    if ($(element).find("input[type='checkbox']:checked")[0] === undefined) {
      checked = false;
    }
  });
  if (checked === false) {
    event.preventDefault();
    alert("Please make sure at least one relation type is selected");
  }
});


function toggleReferenceFields(radio) {
  if ($(radio).val() == 0) {
    $(".reference-fields").find("input").val("foo").change().focusout().disableClientSideValidations().val("").attr("disabled", true);
  } else {
    $(".reference-fields").find("input").attr("disabled", false).enableClientSideValidations();
  }
};

function toggleFreeDNSFields(radio) {
  if ($(radio).val() == 'FreeDNS') {
    $('.free-dns-fields').find('input').attr('disabled', false).enableClientSideValidations();
  } else {
    $('.free-dns-fields').find('input').val('123').change().focusout().disableClientSideValidations().val('').attr('disabled', true);
  }
};

function validateCfcCommentField(radio) {
  $field = $(".cfc-comment textarea");
  if ($(radio).val() == 0) {
    if (/^\s*$/.test($field.val())) {
      $field.val("foo").change().focusout().disableClientSideValidations().val("");
    } else {
      $field.disableClientSideValidations();
    }
  } else {
    $field.enableClientSideValidations();
  }
};